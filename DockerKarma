FROM centos:centos7

# Enable Extra Packages for Enterprise Linux (EPEL) for CentOS
RUN     yum install -y epel-release

# Install Node.js and npm
RUN     yum install -y nodejs npm

# Create directories
RUN	mkdir /reports
RUN	mkdir /test

# Mount Volume for storing reports
VOLUME	reports/ /test-reports

# Copy over necessary files
COPY 	src/public/ /test/public
COPY 	karma.conf.js /test/karma.conf.js
COPY 	package.json /test/package.json

# Set env variable for Phantomjs download
ENV PHANTOMJS_CDNURL=http://cnpmjs.org/downloads

# install dependencies
WORKDIR /test
RUN	yum install -y bzip2 freetype fontconfig 
RUN	npm install
RUN	npm install -g karma
RUN	npm install -g karma-jasmine
RUN	npm install -g karma-junit-reporter
RUN	npm install -g karma-phantomjs-launcher

# Run tests
CMD ["karma", "start"]
